{% extends "base.html" %}

{% block title %}Library - FreeWise{% endblock %}

{% block heading %}Library{% endblock %}

{% block content %}
<p class="text-gray-600 dark:text-gray-400 mb-6">
    Browse your collection of {{ books|length }} book{{ 's' if books|length != 1 else '' }}.
</p>

{% if books %}
<div class="overflow-x-auto rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm">
    <table class="w-full bg-white dark:bg-gray-800">
        <thead class="bg-gray-50 dark:bg-gray-900 border-b-2 border-gray-200 dark:border-gray-700">
            <tr>
                <th class="px-4 py-3 text-left">
                    <a href="/library/ui?sort=title&order={{ 'desc' if current_sort == 'title' and current_order == 'asc' else 'asc' }}" 
                       class="flex items-center gap-1 text-gray-900 dark:text-white font-semibold hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                        <span>Title</span>
                        {% if current_sort == 'title' %}
                            <i data-lucide="{{ 'chevron-down' if current_order == 'desc' else 'chevron-up' }}" class="w-4 h-4"></i>
                        {% endif %}
                    </a>
                </th>
                <th class="px-4 py-3 text-left">
                    <a href="/library/ui?sort=author&order={{ 'desc' if current_sort == 'author' and current_order == 'asc' else 'asc' }}" 
                       class="flex items-center gap-1 text-gray-900 dark:text-white font-semibold hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                        <span>Author</span>
                        {% if current_sort == 'author' %}
                            <i data-lucide="{{ 'chevron-down' if current_order == 'desc' else 'chevron-up' }}" class="w-4 h-4"></i>
                        {% endif %}
                    </a>
                </th>
                <th class="px-4 py-3 text-center">
                    <a href="/library/ui?sort=highlight_count&order={{ 'desc' if current_sort == 'highlight_count' and current_order == 'asc' else 'asc' }}" 
                       class="flex items-center justify-center gap-1 text-gray-900 dark:text-white font-semibold hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                        <span>Highlights</span>
                        {% if current_sort == 'highlight_count' %}
                            <i data-lucide="{{ 'chevron-down' if current_order == 'desc' else 'chevron-up' }}" class="w-4 h-4"></i>
                        {% endif %}
                    </a>
                </th>
                <th class="px-4 py-3 text-center">
                    <a href="/library/ui?sort=last_highlight&order={{ 'desc' if current_sort == 'last_highlight' and current_order == 'asc' else 'asc' }}" 
                       class="flex items-center justify-center gap-1 text-gray-900 dark:text-white font-semibold hover:text-primary-600 dark:hover:text-primary-400 transition-colors"
                       title="Last Highlighted At">
                        <i data-lucide="calendar" class="w-5 h-5"></i>
                        {% if current_sort == 'last_highlight' %}
                            <i data-lucide="{{ 'chevron-down' if current_order == 'desc' else 'chevron-up' }}" class="w-4 h-4"></i>
                        {% endif %}
                    </a>
                </th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
            {% for book in books %}
            <tr class="hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors">
                <td class="px-4 py-3">
                    <a href="/library/ui/book/{{ book.id }}" class="text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 font-medium transition-colors">
                        {{ book.title }}
                    </a>
                    {% if book.document_tags %}
                    <div class="flex flex-wrap gap-1 mt-1">
                        {% for tag in book.document_tags.split(',') %}
                        <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-600 dark:text-gray-400">
                            <i data-lucide="tag" class="w-2.5 h-2.5"></i>
                            {{ tag.strip() }}
                        </span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </td>
                <td class="px-4 py-3 text-gray-600 dark:text-gray-400">
                    {{ book.author }}
                </td>
                <td class="px-4 py-3 text-center">
                    <span class="inline-block bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-1 rounded-full text-sm font-semibold">
                        {{ book.highlight_count }}
                    </span>
                </td>
                <td class="px-4 py-3 text-center">
                    {% if book.last_highlight_date %}
                        <span class="text-gray-500 dark:text-gray-400 text-sm">
                            {{ book.last_highlight_date.strftime('%Y-%m-%d') }}
                        </span>
                    {% else %}
                        <span class="text-gray-400 dark:text-gray-600 italic">â€”</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="text-center py-16 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700">
    <div class="mb-4">
        <i data-lucide="library" class="w-16 h-16 mx-auto text-gray-400 dark:text-gray-600"></i>
    </div>
    <p class="text-xl font-medium text-gray-900 dark:text-white mb-2">Your library is empty</p>
    <p class="text-gray-600 dark:text-gray-400 mb-6">Import highlights from Readwise to get started!</p>
    <a href="/import/ui" class="inline-flex items-center gap-2 bg-primary-600 hover:bg-primary-700 text-white px-6 py-3 rounded-lg transition-colors">
        <i data-lucide="upload" class="w-4 h-4"></i>
        <span>Import Highlights</span>
    </a>
</div>
{% endif %}

<div class="mt-8">
    <a href="/" class="inline-flex items-center gap-2 text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
        <i data-lucide="arrow-left" class="w-4 h-4"></i>
        <span>Back to Home</span>
    </a>
</div>
{% endblock %}
