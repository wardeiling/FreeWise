<div class="highlight" id="highlight-{{ highlight.id }}" style="position: relative;">
    <div class="highlight-text">{{ highlight.text }}</div>
    
    {% if highlight.location_type == "page" and highlight.location %}
    <div style="color: var(--muted-text); font-size: 0.8em; margin-top: 4px;">
        (Page {{ highlight.location }})
    </div>
    {% endif %}
    
    {% if highlight.note %}
    <div class="highlight-source" style="font-style: italic; margin-top: 8px;">
        {{ highlight.note }}
    </div>
    {% endif %}
    
    <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 12px; flex-wrap: wrap; gap: 10px;">
        <div style="display: flex; gap: 10px; align-items: center;">
            <!-- Favorite Star (hidden if discarded) -->
            {% if not highlight.is_discarded %}
            <button 
                class="{% if highlight.favorite or highlight.is_favorited %}btn-favorite active{% else %}btn-favorite{% endif %}"
                hx-post="/highlights/{{ highlight.id }}/favorite"
                hx-vals='{"favorite": "{{ "false" if (highlight.favorite or highlight.is_favorited) else "true" }}", "context": "book"}'
                hx-target="#highlights-sections-wrapper"
                hx-swap="innerHTML"
                title="Toggle favorite">
                {% if highlight.favorite or highlight.is_favorited %}★{% else %}☆{% endif %}
            </button>
            {% endif %}
            
            <!-- Edit Button (hidden if discarded) -->
            {% if not highlight.is_discarded %}
            <button 
                class="btn-edit"
                hx-get="/highlights/{{ highlight.id }}/edit?context=book"
                hx-target="#highlight-{{ highlight.id }}"
                hx-swap="outerHTML"
                title="Edit highlight">
                ✎
            </button>
            {% endif %}
            
            <!-- Discard Toggle (hidden if favorited) -->
            {% if not (highlight.favorite or highlight.is_favorited) %}
            <button 
                class="btn-discard"
                hx-post="/highlights/{{ highlight.id }}/discard"
                hx-vals='{"context": "book"}'
                hx-target="#highlights-sections-wrapper"
                hx-swap="innerHTML"
                hx-confirm="Are you sure you want to {{ 'restore' if highlight.is_discarded else 'discard' }} this highlight?"
                title="{{ 'Restore' if highlight.is_discarded else 'Discard' }} highlight">
                {% if highlight.is_discarded %}
                ↻ Restore
                {% else %}
                ✕ Discard
                {% endif %}
            </button>
            {% endif %}
        </div>
        
        <!-- Status Badges -->
        <div style="display: flex; gap: 8px; align-items: center;">
            {% if highlight.is_discarded %}
            {% endif %}
            <span style="color: var(--muted-text); font-size: 0.8em;">
                {% if highlight.created_at %}
                    {{ highlight.created_at.strftime('%b %d, %Y') }}
                {% else %}
                    <em>Date unknown</em>
                {% endif %}
            </span>
        </div>
    </div>
</div>
